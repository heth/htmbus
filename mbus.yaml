# NATS used between the following components (daemons):
#  - mbusbed  - M-Bus back end daemon (Does the actual M-Bus work)
#  - displayd - Display daemon - Show IP adrress and other stuff on display
#  - mbustb   - M-Bus ThingsBoard daemon - Communicates with IoT ThingsBoard using MQTT
#  - mbusweb  - Flask WEB-server daemon - showing basic information on M-Bus devices

debug:
  mqttpub: False
  mqttsub: True
  mqttbroker: "93.166.84.21"
  mqttsubject: "mbus/debug/raw"

services:
  identity:
  - {service: "mbusbed",  realname: "M-Bus backend daemon"}
  - {service: "mbustbd",  realname: "M-Bus Thingsboard daemon"}
  - {service: "mbuswebd", realname: "M-Bus WEB daemon"}
  - {service: "displayd", realname: "Display daemon"}

#NATS - common setup between daemons 
nats:
  devicetopic: "mbus.device.>"
  request: "mbus.request"
  connect_str: "nats://127.0.0.1:4222" 
  subtopic_data: "data"
  subtopic_error: "error"
  mbusdevice: "mbus.device."

log:
  level: 3    # 3 = Error, 4 = Warning, 6 = Informational, 7 = Debug
  tty: False
  syslog: True
  file: False
  filename: ''


# MQTT used between MBUS device and Thingsboard (daemon mbustb)
mqtt:
  devicetopic: "v1/devices/me/telemetry"
  gatewaytopic: "v1/gateway/telemetry"
  request: "v1/devices/me/rpc/request/+"
  brokerip: "192.168.1.78"
  #brokerip: "10.128.201.15"
  brokerport: "1883"
  username: "heth"
  password: "l8heise"
  clientid: "vvs2"
  #username: "sohp"
  #password: "VVS2024!"
  #clientid: "vvs1"
  keepalive: 3

# M-Bus communication with Meter devices using serial communication
# Used by mbusbed daemon
mbus:
  tty: "/dev/ttyS4"
  baud: 9600
  pollinterval: 60
  csvdir: "/var/www/mbus/csv/" # CSV files directory
  devices:
    - {name: "stand1", address: 68, type: "kam603"}
    - {name: "stand2", address: 69, type: "kam603"}
    #- {group: "stand1", name: "heat 1", address: 70}
    #- {group: "stand1", name: "power 1", address: 71}
    #- {name: "stand4", address: 71}
    
# Small 3.3 volts 2x20 characters LCD display
# Used by displayd daemon
display:
  i2cbus: 2
  i2caddr: 0x3C
  gpiochip: "/dev/gpiochip1"
  gpiopin: 19
  cmd_reg: 0x00
  data_reg: 0x40
  line1: 0x80
  line2: 0xC0
  network: "eth0"
  displaytopic: "display.text"

web:
  csvserver: "192.168.1.96"

meters:
  KAM: 
    man: "Kamstrup"
    dev:
      - {version: 53, name: "Multical 603", python: "kam603"}
#  GAV: "Carlo Gavazzi"
  GAV:
    - {version: 198, name: "EM330-DIN", python: "gav340"}
    - {version: 199, name: "EM340-DIN", python: "gav340"}

